# jitaku_gas - Googleカレンダー連携Discord通知スクリプト

このリポジトリには、Google Apps Script (GAS) を使用してGoogleカレンダーの情報をDiscordに通知するためのスクリプトが含まれています。
主に以下の2つの機能を提供します。

1.  **Googleカレンダー予定変更通知**: 直近1時間以内に更新されたカレンダーイベントをDiscordに通知します。
2.  **Googleカレンダー予定サマリ通知**: 毎日、指定されたカレンダーの今日の予定をDiscordにまとめて通知します。

## 含まれるスクリプト

### 1. `Googleカレンダー予定変更通知.js`

**概要**:
指定された複数のGoogleカレンダーの中から、直近1時間以内に新規作成または更新されたイベントを検出し、Discordの指定チャンネルに通知します。更新がない場合は通知を行いません。

**主な機能**:
- 複数のGoogleカレンダーに対応。
- 直近1時間以内に最終更新されたイベント（新規作成・変更）を検出。
- Discord Webhook を介して通知。
- 終日イベントと時間指定イベントの両方に対応。

**制限事項**:
- 削除されたイベントは検出できません。

### 2. `Googleカレンダー予定サマリ通知.js`

**概要**:
指定された複数のGoogleカレンダーから、その日のすべての予定を取得し、時刻順に並べ替えてDiscordの指定チャンネルにサマリとして通知します。

**主な機能**:
- 複数のGoogleカレンダーに対応。
- その日のすべてのイベントを取得し、時間順に整理。
- イベントのタイトル、時刻、カレンダー名、場所などをDiscordに通知。
- 予定がない場合はその旨を通知。

## セットアップ方法

1.  **Google Apps Script プロジェクトの作成**:
    *   Google Drive にアクセスし、「新規」>「その他」>「Google Apps Script」を選択して新しいプロジェクトを作成します。
    *   または、`script.google.com` にアクセスし、「新しいプロジェクト」を作成します。

2.  **コードの貼り付け**:
    *   作成したGASプロジェクトのスクリプトエディタで、既存のコードをすべて削除し、このリポジトリの `Googleカレンダー予定変更通知.js` と `Googleカレンダー予定サマリ通知.js` の内容をそれぞれ新しい `.js` ファイルとして貼り付けます。
    *   ファイル名は元のスクリプト名に合わせてください（例: `Googleカレンダー予定変更通知.js`）。

3.  **必要なサービスの有効化**:
    *   これらのスクリプトは `CalendarApp` と `UrlFetchApp` サービスを使用します。通常、これらのサービスはデフォルトで有効になっていますが、もしエラーが発生する場合は、GASエディタの「サービス」セクションで確認してください。

## 設定 (スクリプトプロパティ)

GASプロジェクトの「プロジェクトの設定」（左側のギアアイコン）を開き、「スクリプト プロパティ」セクションに以下のキーと値を追加し、保存します。

1.  **`CALENDAR_DISCORD_WEBHOOK_URL`**:
    *   **キー**: `CALENDAR_DISCORD_WEBHOOK_URL`
    *   **値**: 通知先のDiscordチャンネルのWebhook URL。
        (例: `https://discord.com/api/webhooks/YOUR_WEBHOOK_ID/YOUR_WEBHOOK_TOKEN`)

2.  **`CALENDAR_IDS`**:
    *   **キー**: `CALENDAR_IDS`
    *   **値**: 通知したいGoogleカレンダーのIDをカンマ区切りで列挙します。
        (例: `'your-email@gmail.com,calendar-id-1@group.calendar.google.com,calendar-id-2@group.calendar.google.com'`)
        *   カレンダーIDは、Googleカレンダーの設定画面で確認できます。

## トリガーの設定

GASプロジェクトの「トリガー」（左側の時計アイコン）を開き、以下のトリガーを設定します。

### 1. `Googleカレンダー予定変更通知.js` 用のトリガー

*   **実行する関数を選択**: `sendCalendarUpdatesToDiscord`
*   **イベントのソースを選択**: 「時間主導型」
*   **時間ベースのトリガーのタイプを選択**: 「時間タイマー」
*   **時間の間隔を選択**: 例えば「1時間ごと」

### 2. `Googleカレンダー予定サマリ通知.js` 用のトリガー

*   **実行する関数を選択**: `checkCalendarAndNotifyDiscord`
*   **イベントのソースを選択**: 「時間主導型」
*   **時間ベースのトリガーのタイプを選択**: 「日付ベースのタイマー」
*   **時刻を選択**: 例えば「午前 7時～8時」 (毎日通知したい時刻に合わせて設定)

## 権限の承認

トリガーを設定した後、またはスクリプトを初回実行する際に、Googleアカウントの承認を求められます。
以下の権限を承認してください。

-   Googleカレンダーへのアクセス
-   外部サービスへの接続 (Discord Webhookへの通信のため)

## 開発者向け情報

### `setProperties()` 関数について (`Googleカレンダー予定変更通知.js` 内)

`Googleカレンダー予定変更通知.js` には、スクリプトプロパティをプログラムで設定するための一時的なヘルパー関数 `setProperties()` が含まれています。
この関数は、手動でスクリプトプロパティを設定する代わりに、一度だけ実行して設定を書き込むために使用できます。
**使用する際は、関数内の `webhookUrl` と `calendarIds` の値を実際の情報に書き換えてから実行してください。**
一度設定が完了すれば、この関数は不要になります。

---

これで、Googleカレンダーの更新や今日の予定が定期的にDiscordに通知されるようになります。

```
